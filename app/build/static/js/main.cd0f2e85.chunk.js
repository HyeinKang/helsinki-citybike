(this["webpackJsonphelsinki-citybike"]=this["webpackJsonphelsinki-citybike"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},221:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(43),o=a.n(r),s=(a(100),a(9)),c=a(32),l=(a(101),a(20)),u=a.n(l),d=a(46),m=a(59),h=a(17),b=a(33),p=a(58),v=a(13),f=a.n(v),g=a(14),y=a(15),E=a(24),k=a(23),w=a(87),S=a(5),O=a(27),N=function(e){Object(E.a)(a,e);var t=Object(k.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"onAdd",value:function(e){return this._btn=document.createElement("button"),this._btn.className="mapboxgl-ctrl-icon ".concat(this.props.className),this._btn.type="button",this._btn.innerHTML=this.props.innerHTML||"",this._btn.title=this.props.title,this._btn.onclick=this.props.eventHandler,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl",this._container.appendChild(this._btn),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),a}(i.a.Component),j=function(e){return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("div",{className:"station-name"},i.a.createElement("span",null,e.name)," ",i.a.createElement("div",{className:"".concat(e.indicator,"  ").concat(e.isLoading?"is-loading":""," indicator")})),i.a.createElement("div",{className:"station-availity"},i.a.createElement("div",{className:"avilability"},e.bikeAvailability,i.a.createElement("span",{className:"divider"},"/"),e.stationCapability),i.a.createElement("div",{className:"more-info",onClick:function(){var t={stationId:e.stationId,stationName:e.name,stationCapability:e.stationCapability,bikeAvailability:e.bikeAvailability};e.updateSelectedStation(t)}},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},i.a.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),i.a.createElement("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"}))))))},x=Object(O.e)({accessToken:"pk.eyJ1IjoiaGVpbmEta2FuZyIsImEiOiJja2FhNGppb2IwdDNqMnZxd3h1bnFja2NhIn0.si285aYkKGq4jcOjvpryzw"}),_=function(e){Object(E.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).state={center:[24.941531,60.170676],zoom:[16],minZoom:[15],maxZoom:[17]},n}return Object(y.a)(a,[{key:"shouldComponentUpdate",value:function(e,t){var a=!f.a.isEqual(this.state.bounds,t.bounds),n=!f.a.isEqual(this.props.locations,e.locations),i=!f.a.isEqual(this.props.isLoading,e.isLoading);return a||n||i}},{key:"render",value:function(){var e=this.props,t=e.updateBounds,a=e.locations,n=e.isLoading,r=e.updateSelectedStation;function o(e){var t=e.location,a=t.bikesAvailable+t.spacesAvailable,o=t.bikesAvailable,s=o/a*100,c=s>50?"safe":s>0?"warning":"bad";return i.a.createElement(O.c,{coordinates:[t.lon,t.lat],key:t.stationId},i.a.createElement(j,{name:t.name,stationId:t.stationId,indicator:c,isLoading:n,bikeAvailability:o,stationCapability:a,updateSelectedStation:r}))}return i.a.createElement("div",null,i.a.createElement(x,{style:"mapbox://styles/heina-kang/ckahkdlxb014m1itfktw9kt6s",center:this.state.center,zoom:this.state.zoom,minZoom:this.state.minZoom,maxZoom:this.state.maxZoom,containerStyle:{width:"100vw",height:window.innerHeight},onStyleLoad:function(e){var a=new N({title:"Refresh the station information",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px">\n                      <path d="M0 0h24v24H0V0z" fill="none" />\n                      <path\n                        d="M17.65 6.35c-1.63-1.63-3.94-2.57-6.48-2.31-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20c3.19 0 5.93-1.87 7.21-4.56.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53-1.13 2.43-3.84 3.97-6.8 3.31-2.22-.49-4.01-2.3-4.48-4.52C5.31 9.44 8.26 6 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71l-.64.65z" />\n                    </svg>',eventHandler:function(){t(e.getBounds())}}),n=new S.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showUserLocation:!0});e.addControl(a,"top-right"),w.isMobile&&(e.addControl(n,"top-left"),setTimeout((function(){n.trigger()}),500)),t(e.getBounds())},onMoveEnd:function(e){t(e.getBounds())},attributionControl:!1},i.a.createElement(O.b,{type:"symbol",id:"marker",layout:{"icon-image":"bicycle-15"}},a.map((function(e){return i.a.createElement(O.a,{coordinates:[e.lon,e.lat],key:e.stationId})}))),a.map((function(e){return i.a.createElement(o,{key:e.stationId,location:e})})),i.a.createElement(O.d,{position:"bottom-right"})))}}]),a}(i.a.Component),C=a(88),T=a.n(C),B=a(34),A=a.n(B),M=a(89),z=function(e){var t=Object(n.useState)(!1),a=Object(h.a)(t,2),r=a[0],o=a[1];return i.a.createElement("div",{className:"is-open accordion"},i.a.createElement("div",{className:"accordion__header",onClick:function(){o(!r)}},i.a.createElement("div",null,i.a.createElement("p",null,e.heading),i.a.createElement("p",{className:"disclaimer"},e.disclaimer))),i.a.createElement("div",{className:"accordion__body"},e.children))},H=function(e){Object(E.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).toggleOpenState=function(){n.setState({isOpen:!n.state.isOpen})},n.updateSelectedStation=function(){n.props.updateSelectedStation()},n.singularOrPlural=function(e,t,a){var n=t;return e>1&&(n=a),n},n.state={averageBikesToday:"...",bikeTrends:[],dayNumber:A()().tz("Europe/Helsinki").day()},n}return Object(y.a)(a,[{key:"shouldComponentUpdate",value:function(e,t){var a=!f.a.isEqual(this.state.bikeTrends,t.bikeTrends),n=!f.a.isEqual(this.state.dayNumber,t.dayNumber),i=!f.a.isEqual(this.state.averageBikesToday,t.averageBikesToday);return a||n||i}},{key:"render",value:function(){var e=this,t=this.props.selectedStation,a=t.stationId,n=t.stationName,r=t.stationCapability,o=t.bikeAvailability,s=this;T.a.get("api/trends/".concat(a,"/").concat(this.state.dayNumber)).then((function(e){s.setState({bikeTrends:e.data}),"..."===s.state.averageBikesToday&&s.setState({averageBikesToday:f.a.map(e.data,"averageBikesAvailable")[A()().tz("Europe/Helsinki").hour()]})}));var c={labels:f.a.map(this.state.bikeTrends,"time"),datasets:[{label:"Available bikes",backgroundColor:function(){for(var e=A()().tz("Europe/Helsinki").hour(),t=[],a=0;a<=23;a++)t.push("rgba(242, 188, 25, 0.2)");return t[e]="rgba(242, 188, 25, 0.6)",t},borderWidth:0,barThickness:"flex",barPercentage:1,categoryPercentage:1,hoverBackgroundColor:"rgba(242, 188, 25, 0.4)",data:f.a.map(this.state.bikeTrends,"averageBikesAvailable")}]};return i.a.createElement("div",{className:"station-info-popup"},i.a.createElement("div",{className:"station-info-content"},i.a.createElement("div",{className:"station-info-content__header"},i.a.createElement("div",null,i.a.createElement("h2",null,n)),i.a.createElement("div",{className:"close",onClick:this.updateSelectedStation},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},i.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),i.a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),i.a.createElement("div",{className:"station-info-content__content"},i.a.createElement("ul",{className:"accordion-list"},i.a.createElement("li",{className:"accordion-list__item"},i.a.createElement(z,{heading:"Station bike capacity: ".concat(o," / ").concat(r),disclaimer:"".concat(this.state.averageBikesToday," ").concat(this.singularOrPlural(this.state.averageBikesToday,"bike is","bikes are")," usually available at ").concat(A()().tz("Europe/Helsinki").format("h a, dddd"),"s")},i.a.createElement("div",{className:"trend-header"},i.a.createElement("h3",null,"Availability Trend"),i.a.createElement("div",{className:"selected-day"},i.a.createElement("div",{className:"button",onClick:function(){0===e.state.dayNumber?s.setState({dayNumber:6}):s.setState({dayNumber:e.state.dayNumber-1})}},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},i.a.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),i.a.createElement("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}))),i.a.createElement("div",null,["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.state.dayNumber]),i.a.createElement("div",{className:"button",onClick:function(){6===e.state.dayNumber?s.setState({dayNumber:0}):s.setState({dayNumber:e.state.dayNumber+1})}},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},i.a.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),i.a.createElement("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}))))),i.a.createElement("div",{className:"trend-chart"},i.a.createElement(M.a,{data:c,height:400,options:{responsive:!0,layout:{padding:{left:0,right:0,top:0,bottom:0}},scales:{xAxes:[{position:"top",ticks:{beginAtZero:!0,stepSize:5,suggestedMin:5,suggestedMax:10}}],yAxes:[{gridLines:{drawOnChartArea:!1}}]}}}))))))),i.a.createElement("div",{className:"station-info-bg",onClick:this.updateSelectedStation}))}}]),a}(i.a.Component);function L(){var e=Object(m.a)(["\n  query getStation($id: String!) {\n    bikeRentalStation(id:$id) {\n      stationId\n      name\n      bikesAvailable\n      spacesAvailable\n      lat\n      lon\n    }\n  }\n  "]);return L=function(){return e},e}function I(){var e=Object(m.a)(["\n  query getAllStations {\n    bikeRentalStations {\n      stationId\n      lat\n      lon\n    }\n  }\n  "]);return I=function(){return e},e}function q(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(b.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=7;break}return e.next=4,a(t[n],n,t);case 4:n++,e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=function(){var e=Object(n.useState)(null),t=Object(h.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)([]),s=Object(h.a)(o,2),l=s[0],m=s[1],v=Object(n.useState)(null),g=Object(h.a)(v,2),y=g[0],E=g[1],k=Object(n.useState)(!0),w=Object(h.a)(k,2),S=w[0],O=w[1],N=Object(n.useState)(null),j=Object(h.a)(N,2),x=j[0],C=j[1],T=Object(p.a)(),B=Object(c.b)(I()),A=Object(c.b)(L());Object(n.useEffect)((function(){a||function(){var e=Object(b.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.query({query:B});case 2:t=e.sent,a=t.data,r(a.bikeRentalStations);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()();y&&function(){if(!y)return!1;O(!0);var e=y._ne.lng,t=y._ne.lat,n=y._sw.lng,i=y._sw.lat,r=[];a&&a.forEach((function(a){var o=e>=a.lon&&a.lon>=n,s=t>=a.lat&&a.lat>=i;o&&s&&(r=[].concat(Object(d.a)(r),[a]))}));var o=f.a.map(r,"stationId");z(o)}()}),[y,a,T,B]);var M=[],z=function(){var e=Object(b.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t,function(){var e=Object(b.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.query({query:A,variables:{id:t}});case 2:a=e.sent,n=a.data,M=[].concat(Object(d.a)(M),[n.bikeRentalStation]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:setTimeout((function(){O(!1)}),30),m(Object(d.a)(M));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(e,t){C(e)},R=window.innerHeight;return i.a.createElement("div",{style:{height:R}},!!x&&i.a.createElement(H,{updateSelectedStation:Z,selectedStation:x}),i.a.createElement(_,{locations:l,isLoading:S,updateBounds:function(e,t){E(e)},updateSelectedStation:Z}))},V=new c.a({uri:"https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql"});var F=function(){return i.a.createElement(s.a,{client:V},i.a.createElement("div",null,i.a.createElement(R,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},95:function(e,t,a){e.exports=a(221)}},[[95,1,2]]]);
//# sourceMappingURL=main.cd0f2e85.chunk.js.map